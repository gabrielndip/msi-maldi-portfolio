# Repository Guidelines

## Project Structure & Module Organization
`msi_maldi_portfolio_workflow.qmd` is the canonical entry point; it sequentially sources the numbered scripts under `scripts/`, so keep new analytics steps in that folder and follow the `NN_description.R` pattern for reproducible ordering. Raw MSI inputs (imzML/ibd pairs plus optical references) live in `data/`; never edit them in place. Rendered artifacts belong in `msi_maldi_portfolio_workflow_files/figure-html/` and are regenerated by Quarto. Use `journal.md` or `journal.html` to document exploratory notes rather than scattering comments through code.

## Build, Test, and Development Commands
- `quarto render msi_maldi_portfolio_workflow.qmd --to html` builds the full narrative report and refreshes the `msi_maldi_portfolio_workflow_files/` directory.
- `quarto preview msi_maldi_portfolio_workflow.qmd` watches for edits and hot-reloads the HTML, which is ideal while tuning plots or captions.
- `Rscript scripts/05_ssc_segmentation.R` reruns the segmentation step in isolation when you are iterating on clustering parameters.
- `Rscript -e "lintr::lint_dir('scripts')"` surfaces style regressions before opening a PR.

## Coding Style & Naming Conventions
Use 2-space indentation for R and Quarto chunks, pipe-friendly tidyverse formatting, and limit lines to ~80 characters to preserve diff readability. Prefer `snake_case` for objects, `UpperCamelCase` only for S3 classes, and keep function names action-oriented (e.g., `filter_roi_pixels`). File names should remain prefixed with zero-padded step numbers so downstream scripts can source them predictably. Run `styler::style_file()` on any script you touch and commit the styled result.

## Testing Guidelines
There is no formal unit-test harness, so rely on deterministic reruns of the numbered scripts. After major refactors, run `quarto render` plus the individual script(s) you changed to confirm Cardinal objects serialize correctly and plots regenerate without warnings. Compare regenerated figures in `msi_maldi_portfolio_workflow_files/figure-html/` against the previous HTML to spot regressions. When adding new analyses, include a reproducible example chunk in the Quarto document that exercises the code path end-to-end.

## Commit & Pull Request Guidelines
Follow the existing Git history: short, sentence-style subjects such as `Update: Refine data exploration script` work well, but imperative summaries (`Add SSC tuning helper`) are also acceptable. Keep commits focused on one logical change, mention affected scripts in the body, and reference issues when applicable. Pull requests should describe the scientific motivation, list any new output files, and attach before/after screenshots or spectra snippets so reviewers can verify visual changes quickly.

## Security & Configuration Tips
Large MSI assets can exceed GitHub limits; avoid recommitting binaries and document any new datasets in `README.md` instead. Store machine-specific paths or API tokens in an `.Renviron` ignored by Git, and prefer relative paths inside scripts so collaborators on macOS, Linux, or HPC nodes can reproduce results without edits. If you modify preprocessing parameters, note the rationale in `journal.md` to preserve provenance for downstream analyses.
